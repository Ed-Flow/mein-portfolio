<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>El Arvida – Shop</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --brown:#6b4637; --brown-deep:#533528; --accent:#ffe6cc;
      --header-h:72px; --text:#222; --text-strong:#101010;
      --maxw:1200px; --radius:16px; --shadow:0 6px 18px rgba(0,0,0,.08);
      --border:1px solid rgba(0,0,0,.06); --card:#fff; --muted:#5a4a44;
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth; scroll-padding-top:var(--header-h)}
    body{
      margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif; line-height:1.65; color:var(--text);
      background:
        radial-gradient(1400px 900px at 80% -200px, rgba(255,230,204,.35), transparent 60%),
        radial-gradient(1000px 700px at -10% 40%, rgba(255,255,255,.35), transparent 55%),
        linear-gradient(180deg, #f9f6f1 0%, #f1e8df 100%);
      min-height:100vh; display:flex; flex-direction:column;
    }
    a{color:inherit; text-decoration:none}

    /* Header */
    .site-header{
      position:sticky; top:0; z-index:1000;
      background:
        linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02)),
        linear-gradient(0deg, color-mix(in oklab, var(--brown) 92%, transparent), var(--brown-deep));
      backdrop-filter:saturate(140%) blur(8px);
      border-bottom:1px solid rgba(255,255,255,.14);
      box-shadow:0 10px 30px rgba(0,0,0,.1); color:#fff;
    }
    .header-bar{display:flex; align-items:center; justify-content:center; min-height:var(--header-h); position:relative;}
    .primary-nav{display:flex; gap:32px; align-items:center; justify-content:center;}
    .primary-nav a{color:#fff; font-weight:800; font-size:1.1rem; padding:10px 14px; border-radius:10px; position:relative; opacity:.95;}
    .primary-nav a:hover{background:rgba(255,255,255,.10); opacity:1;}
    .primary-nav a.is-active{background:rgba(255,255,255,.14);}
    .primary-nav a::after{content:""; position:absolute; left:14px; right:14px; bottom:6px; height:2px; background:var(--accent); transform:scaleX(0); transform-origin:left; transition:transform .22s ease;}
    .primary-nav a:hover::after, .primary-nav a.is-active::after{transform:scaleX(1);}
    .nav-toggle{display:none; position:absolute; right:66px; top:50%; transform:translateY(-50%); width:42px; height:42px; border:0; background:transparent; cursor:pointer;}
    .nav-toggle span{display:block; width:24px; height:2px; margin:6px auto; background:#fff; border-radius:2px; transition:transform .2s ease, opacity .2s ease;}
    .mobile-nav{display:none;}
    .cart-btn{position:absolute; right:18px; top:50%; transform:translateY(-50%); display:inline-flex; align-items:center; gap:10px; color:#fff; font-weight:900; background:rgba(255,255,255,.1); border:1px solid rgba(255,255,255,.28); border-radius:12px; padding:10px 12px; cursor:pointer;}
    .cart-badge{min-width:22px; height:22px; display:inline-flex; align-items:center; justify-content:center; background:#fff; color:#4d3328; border-radius:999px; font-size:.85rem; padding:0 6px; font-weight:900;}
    @media (max-width:768px){
      .primary-nav{display:none;} .nav-toggle{display:block;}
      .mobile-nav{display:grid; grid-template-columns:1fr; gap:10px; padding:12px 18px 16px; background:color-mix(in oklab, var(--brown) 96%, black 0%); border-bottom:1px solid rgba(255,255,255,.14);}
      .mobile-nav a{display:block; text-align:center; color:#fff; font-weight:800; padding:10px 12px; border-radius:10px; background:rgba(255,255,255,.08);}
      .mobile-nav a:hover{background:rgba(255,255,255,.18);}
      .site-header:not(.open) .mobile-nav{display:none;}
      .site-header.open .nav-toggle span:nth-child(1){transform:translateY(8px) rotate(45deg);}
      .site-header.open .nav-toggle span:nth-child(2){opacity:0;}
      .site-header.open .nav-toggle span:nth-child(3){transform:translateY(-8px) rotate(-45deg);}
    }

    /* Seite */
    .wrap{max-width:var(--maxw); margin:0 auto; padding:26px 16px 60px; flex:1;}
    .shop-head{text-align:center; margin-bottom:18px;}
    h1{margin:0 0 12px; font-size:clamp(26px,3vw,34px); font-weight:900; color:var(--text-strong);}
    .filters{display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:center; margin-bottom:22px;}
    .chip{border:1px solid #d3c7ba; background:#fff; border-radius:999px; padding:10px 14px; font-weight:900; cursor:pointer; box-shadow:0 2px 6px rgba(0,0,0,.06);}
    .chip.active{background:color-mix(in oklab, var(--brown) 80%, white 0%); border-color:#5a3c2f; color:#fff}

    /* Karten */
    .grid{display:grid; grid-template-columns:repeat(4,1fr); gap:18px; align-items:stretch;}
    .card{background:var(--card); border:var(--border); border-radius:var(--radius); box-shadow:var(--shadow); overflow:hidden; display:flex; flex-direction:column; height:100%;}
    .thumb{height:240px; padding:12px; background:#f4ece8; display:flex; align-items:center; justify-content:center; cursor:pointer;}
    .thumb img{max-height:100%; max-width:100%;}
    .body{display:grid; grid-template-rows:auto 1fr auto; gap:10px; padding:14px;}
    .title{margin:0 0 6px; cursor:pointer}
    .desc{margin:0;}
    .btn{display:inline-flex; align-items:center; justify-content:center; gap:10px; padding:12px 18px; border-radius:10px; border:2px solid var(--brown); background:var(--brown); color:#fff; font-weight:900; cursor:pointer; box-shadow:0 6px 14px rgba(0,0,0,.16);}
    .btn.secondary{background:#fff; color:#4b362f}
    .btn:hover{filter:brightness(1.07); transform:translateY(-1px);}
    .select-btn[aria-pressed="true"]{background:#fff; color:#4b362f}

    /* Drawer */
    .drawer{position:fixed; right:0; top:0; height:100%; width:min(360px,92%); background:#fff; border-left:var(--border); box-shadow:-10px 0 30px rgba(0,0,0,.18); display:none; z-index:1003; padding:16px; overflow:auto;}
    .drawer header{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:10px}
    .drawer h2{margin:0; font-size:22px; font-weight:900}
    .line{height:1px; background:#eee; margin:10px 0}
    .cart-list{display:grid; gap:10px}

    .cart-item{display:grid; grid-template-columns:56px minmax(0,1fr) auto; align-items:center; gap:12px; border:1px solid #eee; border-radius:12px; padding:12px;}
    .cart-item img{width:56px; height:auto; border-radius:8px; background:#f6f2ef; border:1px solid #eee}
    .info{min-width:0;}
    .info .t{font-weight:800; margin-bottom:2px}
    .info .d{color:#6a5a54; font-size:.92rem; line-height:1.35; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden;}
    .actions{justify-self:end; display:flex; align-items:center; gap:8px; background:#faf7f5; border:1px solid #eadfd8; padding:6px; border-radius:12px; white-space:nowrap;}
    .qtywrap{display:flex; align-items:center; gap:8px;}
    .qtybtn{width:32px; height:32px; display:inline-flex; align-items:center; justify-content:center; border:1px solid #cdb9ad; background:#fff; border-radius:8px; font-size:16px; font-weight:900; line-height:1; cursor:pointer;}
    .qtybtn:hover{background:#f4eee9;}
    .qtybtn:focus-visible{outline:2px solid #6b4637; outline-offset:2px;}
    .qtyval{width:26px; text-align:center; font-variant-numeric:tabular-nums; font-weight:800;}
    .delbtn{display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border:1px solid #e5d6cf; background:#fff; border-radius:8px; cursor:pointer; font-size:16px; line-height:1;}
    .delbtn:hover{background:#f8f3f0}
    .drawer .bottom{position:sticky; bottom:0; background:#fff; padding-top:10px}
    .empty{color:#666; font-size:.95rem}

    footer{text-align:center; padding:24px; background:rgba(255,255,255,.7); font-size:.95rem; border-top:var(--border);}
    footer a{color:#333; text-decoration:none; font-weight:700;}
    footer a:hover{text-decoration:underline;}

    @media (max-width:1100px){ .grid{grid-template-columns:repeat(3,1fr)} }
    @media (max-width:900px){ .grid{grid-template-columns:repeat(2,1fr)} }
    @media (max-width:520px){ .grid{grid-template-columns:1fr} }

    @media (max-width:420px){
      .cart-item{grid-template-columns:56px minmax(0,1fr); grid-template-areas:"img info" "img actions";}
      .cart-item img{grid-area:img;} .cart-item .info{grid-area:info;} .cart-item .actions{grid-area:actions; justify-self:end;}
    }

    /* Modal */
    body.modal-open{overflow:hidden}
    .modal-backdrop{position:fixed; inset:0; background:rgba(0,0,0,.35); opacity:0; pointer-events:none; transition:opacity .2s ease; z-index:1100;}
    .modal{position:fixed; inset:0; display:grid; place-items:center; pointer-events:none; z-index:1101;}
    .modal-inner{width:min(860px,92vw); background:#fff; border-radius:18px; box-shadow:0 20px 60px rgba(0,0,0,.28); border:1px solid rgba(0,0,0,.06); overflow:hidden; transform:translateY(10px); opacity:0; transition:opacity .2s ease, transform .2s ease;}
    .modal header{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:16px 18px; border-bottom:1px solid #eee;}
    .modal header h3{margin:0; font-size:20px; font-weight:900}
    .modal .close{width:36px; height:36px; display:inline-flex; align-items:center; justify-content:center; border:1px solid #e5d6cf; background:#fff; border-radius:10px; cursor:pointer; font-size:18px;}
    .modal .content{display:grid; grid-template-columns:360px 1fr; gap:18px; padding:16px;}
    .modal .content .pic{background:#f4ece8; border:1px solid #eee; border-radius:12px; display:flex; align-items:center; justify-content:center; padding:12px;}
    .modal .content img{max-width:100%; height:auto}
    .modal .meta p{margin:.3rem 0 1rem}
    .features{margin:0; padding-left:18px}
    .features li{margin:.3rem 0}
    .modal .actions-row{display:flex; gap:10px; align-items:center; margin-top:14px}
    .modal .muted{color:#6a5a54}
    .modal.show .modal-inner{opacity:1; transform:none; pointer-events:auto}
    .modal.show ~ .modal-backdrop{opacity:1; pointer-events:auto}
    @media (max-width:740px){ .modal .content{grid-template-columns:1fr} }

    /* Shop-Header fix: Burger + Warenkorb getrennt ausrichten (mobil) */
@media (max-width:768px){
  .header-bar{
    display:flex;
    align-items:center;
    justify-content:flex-start;
    padding:0 12px;
    position:relative; /* nur zur Sicherheit */
    min-height:56px;
  }
  .nav-toggle{
    position:static;   /* nicht absolut → kein Überlappen */
    transform:none;
    margin:0;
    width:40px; height:40px;
  }
  .cart-btn{
    position:static;   /* nicht absolut */
    transform:none;
    margin-left:auto;  /* schiebt den Warenkorb ganz nach rechts */
  }
}

/* Header immer sichtbar auf Mobil */
.site-header{ position: sticky; position: -webkit-sticky; top: 0; z-index: 1000; }
html{ scroll-padding-top: var(--header-h, 72px); }
@supports not (position: sticky){
  @media(max-width:768px){
    .site-header{ position: fixed; top: 0; left: 0; right: 0; }
    body{ padding-top: var(--header-h, 72px); }
  }
}
/* optional: kleiner Schatten beim Scrollen */
.site-header.is-scrolled{ box-shadow: 0 8px 24px rgba(0,0,0,.18); }

/* Modal fix mobil/desktop */
.product-modal{                 /* dein Overlay */
  position: fixed; inset: 0; z-index: 10000;
  display: flex; align-items: center; justify-content: center;
  padding: 12px;
  background: rgba(0,0,0,.25);
}
.product-modal .modal-card{     /* die weiße Karte im Overlay */
  width: min(100%, 920px);
  max-height: calc(100dvh - 24px);   /* passt in den Screen */
  overflow: hidden;                   /* Rahmen bleibt sauber */
  border-radius: 14px; background: #fff;
  display: flex; flex-direction: column;
}
.product-modal .modal-body{     /* eigentlicher Inhalt */
  overflow-y: auto;             /* ← HIER wird gescrollt */
  -webkit-overflow-scrolling: touch;
  padding: 16px;
}

/* Layout innen: Bild/Details stacken auf Mobil */
@media (max-width: 768px){
  .product-modal .modal-body .grid{ display:block; }
  .product-modal .modal-body img{
    width: 100%; height: auto; max-height: 40vh; object-fit: contain;
  }
}

html.modal-open, body.modal-open { overflow: hidden; }




  
/* ==== Modal viewport fit & inner scrolling (mobile + desktop) ==== */
.modal{ padding:12px; }
.modal-inner{
  width: min(920px, 100% - 24px);
  max-height: calc(100dvh - 24px);
  display: flex; flex-direction: column;
  overflow: hidden;
}
.modal header{
  position: sticky; top: 0; z-index: 1;
  background: #fff;
}
.modal .content{
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  padding: 16px;
}
@media (max-width: 740px){
  .modal .content{ display: block; }
  .modal .content .pic img{
    width: 100%; height: auto; max-height: 40vh; object-fit: contain;
  }
}
html.modal-open, body.modal-open { overflow: hidden; }

</style>
</head>
<body>

  <!-- HEADER -->
  <header class="site-header" id="site-header">
    <div class="header-bar">
      <nav class="primary-nav" aria-label="Hauptnavigation">
        <a href="index.html#start">Startseite</a>
        <a href="index.html#leistungen">Leistungen</a>
        <a href="index.html#kontakt">Kontakt</a>
        <a href="shop.html" class="is-active">Shop</a>
      </nav>
      <button class="nav-toggle" id="nav-toggle" aria-expanded="false" aria-controls="mobile-nav" aria-label="Menü öffnen">
        <span></span><span></span><span></span>
      </button>
      <button class="cart-btn" id="openCart" aria-haspopup="dialog" aria-expanded="false">
        Warenkorb <span class="cart-badge" id="cartCount">0</span>
      </button>
    </div>
    <div class="mobile-nav" id="mobile-nav">
      <a href="index.html#start">Startseite</a>
      <a href="index.html#leistungen">Leistungen</a>
      <a href="index.html#kontakt">Kontakt</a>
      <a href="shop.html">Shop</a>
    </div>
  </header>

  <!-- CONTENT -->
  <main class="wrap" id="shop">
    <div class="shop-head">
      <h1>Shop</h1>
      <div class="filters" id="filters"></div>
    </div>
    <div class="grid" id="grid" aria-live="polite"></div>
  </main>

  <footer>
    © 2025 El Arvida – Alle Rechte vorbehalten ·
    <a href="impressum.html">Impressum</a> ·
    <a href="datenschutz.html">Datenschutz</a>
  </footer>

  <!-- Drawer Warenkorb -->
  <aside class="drawer" id="cartDrawer" role="dialog" aria-modal="true" aria-labelledby="cartTitle">
    <header>
      <h2 id="cartTitle">Warenkorb</h2>
      <button class="delbtn" id="closeCart" aria-label="Schließen">×</button>
    </header>
    <div class="cart-list" id="cartList"></div>
    <div class="line"></div>
    <div class="bottom">
      <button class="btn" id="askOffer">Angebot anfragen</button>
    </div>
  </aside>

  <!-- Produkt-Detail-Modal -->
  <div class="modal" id="productModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-hidden="true">
    <div class="modal-inner" role="document">
      <header>
        <h3 id="modalTitle">Produkt</h3>
        <button class="close" id="modalClose" aria-label="Schließen">×</button>
      </header>
      <div class="content">
        <div class="pic"><img id="modalImg" alt=""></div>
        <div class="meta">
          <p class="muted" id="modalCategory"></p>
          <p id="modalDesc"></p>
          <ul class="features" id="modalFeatures"></ul>
          <div class="actions-row">
            <button class="btn" id="modalAdd">In den Warenkorb</button>
            <button class="btn secondary" id="modalClose2">Schließen</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-backdrop" id="modalBackdrop"></div>

  <script>
    /* Mobiles Menü */
    (function(){
      const header = document.getElementById('site-header');
      const btn = document.getElementById('nav-toggle');
      const mob = document.getElementById('mobile-nav');
      if(btn){
        btn.addEventListener('click', ()=>{
          const open = header.classList.toggle('open');
          btn.setAttribute('aria-expanded', open ? 'true' : 'false');
        });
        mob.querySelectorAll('a').forEach(a=>a.addEventListener('click', ()=> header.classList.remove('open')));
      }
    })();

    /* ----------------------- PRODUKT-DATEN ----------------------- */
    // Kategorien: Kaffee Automat, Snack & Food Automat, Theken Automat
    const PRODUCTS = [
      // Theken Automat
      { id:'kometa', cartId:'kometa', displayName:'Necta Kometa',
    title:'Necta Kometa', desc:'Tisch Vollautomat für Theke und Büro.',
    details:'Kompakter Vollautomat für kleine bis mittlere Teams – leise, servicefreundlich, konstante Qualität.',
    features:[
      '80–100 Tassen/Tag empfohlen',
      'Z4000 HoReCa Brüher (14 g); Bohnenbehälter 0,6–1,1 kg',
      'Wasseroptionen & Zubehör: 20-L-Tank (auch mit FlowJet), 5-L-Externtank, MDB-Kit, Abwasser-Festanschluss, Satzauswurf'
    ],
    img:'assets/kometa.png', cat:'Theken Automat' },

  { id:'krea-prime', cartId:'krea-prime', displayName:'Necta KREA Prime ES + 3 IN',
    title:'Necta KREA Prime', desc:'Beliebter Table Top Kaffeeautomat.',
    details:'Table-Top-Vollautomat für Büro & Empfang – robuste HoReCa-Technik, schnelle Ausgabe, einfache Reinigung.',
    features:[
      'ca. 150 Tassen/Tag empfohlen',
      'Z4000 HoReCa Brüher (14 g); Bohnenbehälter ~1,2 kg',
      'Payment vorbereitet (MDB/EXE), seitliches Bezahlmodul optional',
      'Wasseroptionen: 20-L-Tank-Kit, Abwasser-Festanschluss'
    ],
    img:'assets/krea_prime.png', cat:'Theken Automat' },

  { id:'krea-touch', cartId:'krea-touch', displayName:'Necta KREA Touch',
    title:'Necta KREA Touch', desc:'Premium Kaffeeautomat mit optionaler Frischmilch.',
    details:'Touch-Bedienung und HoReCa-Brüher – ideal für Büros und Lounges.',
    features:[
      'ca. 150 Tassen/Tag empfohlen',
      '10″ Touchdisplay, Z4000 HoReCa Brüher (14 g)',
      'Payment vorbereitet (MDB/EXE), Frischmilch-Option'
    ],
    img:'assets/krea_touch.png', cat:'Theken Automat' },

  { id:'kalea-2', cartId:'kalea-2', displayName:'Necta Kalea 2 ES + IN',
    title:'Necta Kalea', desc:'Premium Kaffeeautomat mit optionaler Frischmilch.',
    details:'Barista-Qualität auf Knopfdruck – für repräsentative Zonen und höhere Frequenzen.',
    features:[
      'ca. 150–200 Tassen/Tag (Modell/Setup)',
      '10″ Touch, Z4000 HoReCa Brüher (14 g), optional Frischmilch',
      'Payment vorbereitet (MDB/EXE), Zubehör: Kühlschrank/Unterschrank'
    ],
    img:'assets/kalea.png', cat:'Theken Automat' },

  /* Kaffee Automat (Barista-Familie) */

  { id:'barista-1000-touch-1bw', cartId:'barista-1000-touch-1bw', displayName:'Barista 1000 Touch 1 BW',
    title:'Barista 1000 Touch 1 BW', desc:'Großer Heißgetränkeautomat für Standorte mit hoher Frequenz.',
    details:'Leistungsstarker Vollautomat mit Touchscreen für stark frequentierte Standorte.',
    features:[
      'bis zu 700 Becher/Tag',
      'Z4000 Brüher, 2 Boiler, 1 Becherwerk, 13,3″ Touch',
      'Cashless ready (MDB/EXE), integrierte Konnektivität, Breasy',
      'Großes Bechermagazin'
    ],
    img:'assets/barista_1000.png', cat:'Kaffee Automat' },

  { id:'barista-1000-touch-2bw', cartId:'barista-1000-touch-2bw', displayName:'Barista 1000 Touch 2 BW',
    title:'Barista 1000 Touch 2 BW', desc:'Großer Heißgetränkeautomat für Standorte mit hoher Frequenz.',
    details:'Robuster Standautomat mit hohem Durchsatz.',
    features:[
      'bis zu 700 Becher/Tag',
      'Z4000, 2 Boiler, 2 Becherwerke, 13,3″ Touch',
      'Cashless ready (MDB/EXE), integrierte Konnektivität, Breasy'
    ],
    img:'assets/barista_1000.png', cat:'Kaffee Automat' },

  { id:'barista-1000-1bw', cartId:'barista-1000-1bw', displayName:'Barista 1000 1 BW',
    title:'Barista 1000 1 BW', desc:'Großer Heißgetränkeautomat für Standorte mit hoher Frequenz.',
    details:'Robuster Standautomat mit hohem Durchsatz.',
    features:[
      'bis zu 700 Becher/Tag',
      'Z4000, 2 Boiler, 1 Becherwerk, Direktwahl',
      'Cashless ready (MDB/EXE), Breasy-ready'
    ],
    img:'assets/barista_1000.png', cat:'Kaffee Automat' },

  { id:'barista-1000-2bw', cartId:'barista-1000-2bw', displayName:'Barista 1000 2 BW',
    title:'Barista 1000 2 BW', desc:'Großer Heißgetränkeautomat für Standorte mit hoher Frequenz.',
    details:'Robuster Standautomat mit hohem Durchsatz.',
    features:[
      'bis zu 700 Becher/Tag',
      'Z4000, 2 Boiler, 2 Becherwerke, Direktwahl',
      'Cashless ready (MDB/EXE), Breasy-ready'
    ],
    img:'assets/barista_1000.png', cat:'Kaffee Automat' },

  { id:'barista-600', cartId:'barista-600', displayName:'Barista 600',
    title:'Barista 600', desc:'Zuverlässiger Automat für mittlere bis hohe Frequenzen.',
    details:'Bewährte Technik mit sehr guter Ausgabeleistung.',
    features:[
      'bis zu 600 Becher/Tag',
      'Z4000 Brüher, 1 Boiler, große Auswahl',
      'Cashless ready (MDB/EXE)'
    ],
    img:'assets/barista_600.png', cat:'Kaffee Automat' },

  { id:'barista-500-touch', cartId:'barista-500-touch', displayName:'Barista 500 Touch',
    title:'Barista 500 Touch', desc:'Großer Heißgetränkeautomat.',
    details:'Starkes Preis-Leistungs-Verhältnis mit Touchbedienung.',
    features:[
      'bis zu 500 Becher/Tag',
      'Z4000, 1 Boiler, 13,3″ Touch',
      'Cashless ready (MDB/EXE)'
    ],
    img:'assets/barista_touch_500.png', cat:'Kaffee Automat' },

  { id:'barista-300-touch', cartId:'barista-300-touch', displayName:'Barista 300 Touch',
    title:'Barista 300 Touch', desc:'Solide Technik für häufige Nutzung.',
    details:'Kompakter Standautomat mit Touchbedienung.',
    features:[
      'bis zu 300 Becher/Tag',
      'Z4000, 1 Boiler, Touch',
      'Cashless ready (MDB/EXE)'
    ],
    img:'assets/barista_touch_300.png', cat:'Kaffee Automat' },

      // Snack & Food (später ergänzbar)
      // { id:'snack-1', cartId:'snack-1', ... , cat:'Snack & Food Automat' },
      
      { id:'gusto-10', cartId:'gusto-10', displayName:'Gusto 10',
    title:'Gusto 10', desc:'Snack & Food Automat mit hoher Kapazität.',
    details:'Vielseitiger Automat mit ETL-Preisschildern und Vandalismusschutz.',
    features:[
      'bis zu 400 Verkäufe/Tag empfohlen',
      '55 Wahlen / 6 Schubladen; bis zu 2 Temperaturzonen (Snack/Drink)',
      'Payment MDB/EXE, Breasy-ready'
    ],
    img:'assets/gusto_10-removebg-preview.png', cat:'Snack & Food Automat' },

  { id:'gusto-8-lift', cartId:'gusto-8-lift', displayName:'Gusto 8 Lift',
    title:'Gusto 8 Lift', desc:'Produktschonende Ausgabe über Lift.',
    details:'Ideal für empfindliche Waren – sichere, sanfte Auslieferung.',
    features:[
      'bis zu 350 Verkäufe/Tag empfohlen',
      'Lift-Ausgabe, bis zu 2 Temperaturzonen',
      'Payment MDB/EXE, Vandalismusschutz'
    ],
    img:'assets/gusto_8_lift-removebg-preview.png', cat:'Snack & Food Automat' },

  { id:'gusto-8', cartId:'gusto-8', displayName:'Gusto 8',
    title:'Gusto 8', desc:'Flexibler Snack/Drink Automat.',
    details:'Kapazitive Tastatur, Thermoglas, LED-Innenraum.',
    features:[
      'bis zu 330 Verkäufe/Tag empfohlen',
      '30 Wahlen / 6 Schubladen; bis zu 2 Temperaturzonen',
      'Payment MDB/EXE, Breasy-ready'
    ],
    img:'assets/gusto_8-removebg-preview.png', cat:'Snack & Food Automat' },

  { id:'gusto-8-twin', cartId:'gusto-8-twin', displayName:'Gusto 8 Twin',
    title:'Gusto 8 Twin', desc:'Kombi Snack/Flasche/Food.',
    details:'Mehr Sortiment durch Twin-Bestückung.',
    features:[
      'bis zu 360 Verkäufe/Tag empfohlen',
      '44 Wahlen; Zonen z. B. Food 0–4 °C / Snack 8–15 °C / Drink 5–8 °C',
      'Payment MDB/EXE'
    ],
    img:'assets/version--gusto-8t-win.png', cat:'Snack & Food Automat' },

  { id:'gusto-6-L', cartId:'gusto-6-L', displayName:'Gusto 6 L',
    title:'Gusto 6 L', desc:'Snack & Drink mit zwei Temperaturzonen.',
    details:'Kompakter Automat für mittelstarke Standorte.',
    features:[
      'bis zu 300 Verkäufe/Tag empfohlen',
      '30 Wahlen / 6 Schubladen; 2 Zonen (z. B. 5–7 °C / 10–15 °C)',
      'Payment MDB/EXE'
    ],
    img:'assets/gusto_6_L-removebg-preview.png', cat:'Snack & Food Automat' },

  { id:'gusto-6-M', cartId:'gusto-6-M', displayName:'Gusto 6 M',
    title:'Gusto 6 M', desc:'Snack & Drink – LED-Innenraum, Fotozellen.',
    details:'Kapazitive Tastatur, Thermoglas, optional Telemetrie.',
    features:[
      'bis zu 300 Verkäufe/Tag empfohlen',
      '30 Wahlen / 6 Schubladen; bis zu 2 Temperaturzonen',
      'Payment MDB/EXE, Breasy-ready'
    ],
    img:'assets/gusto_6_M-removebg-preview.png', cat:'Snack & Food Automat' },

  { id:'gusto-6-M-twin', cartId:'gusto-6-M-twin', displayName:'Gusto 6 M Twin',
    title:'Gusto 6 M Twin', desc:'Snack/Food-Kombi mit bis zu 3 Zonen.',
    details:'Für gemischte Waren inkl. Frischeprodukte.',
    features:[
      'bis zu 280 Verkäufe/Tag empfohlen',
      '30 Wahlen / 6 Schubladen; Zonen z. B. Food 0–4 °C / Snack 8–15 °C',
      'Payment MDB/EXE'
    ],
    img:'assets/gusto_6_M_twin-removebg-preview.png', cat:'Snack & Food Automat' },

  { id:'gusto-6-M-mini', cartId:'gusto-6-M-mini', displayName:'Gusto 6 Mini',
    title:'Gusto 6 Mini', desc:'Kompakter Automat – Steuerung via Brio Touch/Solista.',
    details:'Kleine Stellfläche, ideal als Ergänzung.',
    features:[
      'bis zu 170 Verkäufe/Tag empfohlen',
      '21 Wahlen / 4 Schubladen; Snack/Flasche/Dose',
      'Payment MDB/EXE'
    ],
    img:'assets/gusto_6_mini-removebg-preview.png', cat:'Snack & Food Automat' },

  { id:'gusto-6-drum-classic', cartId:'gusto-6-drum-classic', displayName:'Gusto 6 Drum Classic',
    title:'Gusto 6 Drum Classic', desc:'Trommelautomat (Shopper/FIFO).',
    details:'Für Menüs & Frischeprodukte – klare Warenpräsentation.',
    features:[
      'bis zu 180 Verkäufe/Tag empfohlen',
      '10 Trommeln, Teller bis ~230 mm',
      'Payment MDB/EXE'
    ],
    img:'assets/gusto_drum_classic-removebg-preview.png', cat:'Snack & Food Automat' },

  { id:'gusto-6-drum', cartId:'gusto-6-drum', displayName:'Gusto 6 Drum',
    title:'Gusto 6 Drum', desc:'Trommelautomat (Shopper/FIFO).',
    details:'Robust und zuverlässig für gekühlte Frischeprodukte.',
    features:[
      'bis zu 180 Verkäufe/Tag empfohlen',
      '10 Trommeln, Thermoglas, LED-Innenraum',
      'Payment MDB/EXE'
    ],
    img:'assets/gusto_drum-removebg-preview.png', cat:'Snack & Food Automat' },   

    ];

    const CATS = ['Alle','Kaffee Automat','Snack & Food Automat','Theken Automat'];

    /* ----------------------- ROBUSTER WARENKORB ----------------------- */
    // Gültige cartIds aus den aktuellen Produkten
    const VALID_CART_IDS = new Set(PRODUCTS.map(p => p.cartId));

    // Optional: sehr alte Keys gezielt migrieren (leer lassen = entfernen)
    const LEGACY_CART_ID_MAP = {
      // "necta": "kalea-2",   // Beispiel-Migration
    };

    // Rohzugriff auf Storage
    function _readCartRaw() {
      try { return JSON.parse(sessionStorage.getItem('cartItems') || '[]'); }
      catch { return []; }
    }
    function _writeCartRaw(items) {
      sessionStorage.setItem('cartItems', JSON.stringify(items));
    }

    // Sanitize: mappe Legacy → neue IDs, filtere Ungültige
    function _sanitize(items) {
      const mapped = items.map(id => LEGACY_CART_ID_MAP[id] ?? id);
      return mapped.filter(id => VALID_CART_IDS.has(id));
    }

    // Öffentliche Cart-API – ab hier nur diese nutzen!
    function loadCart() {
      const raw = _readCartRaw();
      const clean = _sanitize(raw);
      if (clean.length !== raw.length) _writeCartRaw(clean);
      return clean;
    }
    function saveCart(items) {
      const clean = _sanitize(items);
      _writeCartRaw(clean);
      try { updateCount(); } catch(e){}
      return clean;
    }

    // Einmalige Migration beim Seitenaufruf
    (function migrateCartOnce(){
      const raw = _readCartRaw();
      const clean = _sanitize(raw);
      if (clean.length !== raw.length) _writeCartRaw(clean);
    })();

    /* ----------------------- UI-Elemente ----------------------- */
    const grid = document.getElementById('grid');
    const filters = document.getElementById('filters'); /* <— nur HIER deklariert */
    const openCartBtn = document.getElementById('openCart');
    const closeCartBtn = document.getElementById('closeCart');
    const cartDrawer = document.getElementById('cartDrawer');
    const cartList = document.getElementById('cartList');
    const cartCount = document.getElementById('cartCount');
    const askOfferBtn = document.getElementById('askOffer');

    // Modal
    const modal = document.getElementById('productModal');
    const modalBackdrop = document.getElementById('modalBackdrop');
    const modalTitle = document.getElementById('modalTitle');
    const modalImg = document.getElementById('modalImg');
    const modalDesc = document.getElementById('modalDesc');
    const modalCat = document.getElementById('modalCategory');
    const modalFeatures = document.getElementById('modalFeatures');
    const modalClose = document.getElementById('modalClose');
    const modalClose2 = document.getElementById('modalClose2');
    const modalAddBtn = document.getElementById('modalAdd');

    let lastFocusedEl = null;
    let modalProductId = null;

    /* ----------------------- Warenkorb Logik ----------------------- */
    function countAll(){ return loadCart().length; }
    function countsMap(){ const m={}; for(const id of loadCart()){ m[id]=(m[id]||0)+1; } return m; }
    function updateCount(){ cartCount.textContent = String(countAll()); openCartBtn.setAttribute('aria-expanded', cartDrawer.style.display === 'block' ? 'true' : 'false'); }

    function addToCart(cartId){
      const items = loadCart(); items.push(cartId);
      saveCart(items); markButtons(items); renderCart();
    }
    function removeOne(cartId){
      const items = loadCart(); const idx = items.indexOf(cartId);
      if(idx > -1){ items.splice(idx,1); saveCart(items); markButtons(items); renderCart(); }
    }
    function removeAll(cartId){
      const items = loadCart().filter(x=>x!==cartId); saveCart(items); markButtons(items); renderCart();
    }

    function renderCart(){
      // Sanitize bei jedem Render
      saveCart(loadCart());
      const items = loadCart();

      if(items.length === 0){
        cartList.innerHTML = `<div class="empty">Ihr Warenkorb ist leer.</div>`;
        return;
      }
      cartList.innerHTML = '';
      const grouped = countsMap();

      Object.entries(grouped).forEach(([cartId, qty])=>{
        const p = PRODUCTS.find(x=>x.cartId===cartId);
        if(!p) return;
        const row = document.createElement('div');
        row.className = 'cart-item';
        row.innerHTML = `
          <img src="${p.img}" alt="${p.displayName || p.title}">
          <div class="info">
            <div class="t">${p.displayName || p.title}</div>
            <div class="d">${p.desc}</div>
          </div>
          <div class="actions">
            <div class="qtywrap">
              <button class="qtybtn" data-minus="${cartId}" aria-label="Menge verringern">−</button>
              <span class="qtyval" id="q-${cartId}">${qty}</span>
              <button class="qtybtn" data-plus="${cartId}" aria-label="Menge erhöhen">+</button>
            </div>
            <button class="delbtn" data-remove-all="${cartId}" aria-label="Alle entfernen">×</button>
          </div>
        `;
        row.querySelector('[data-plus]').addEventListener('click', ()=> addToCart(cartId));
        row.querySelector('[data-minus]').addEventListener('click', ()=> removeOne(cartId));
        row.querySelector('[data-remove-all]').addEventListener('click', ()=> removeAll(cartId));
        cartList.appendChild(row);
      });
    }

    function openCart(){ cartDrawer.style.display = 'block'; renderCart(); openCartBtn.setAttribute('aria-expanded','true'); updateCount(); }
    function closeCart(){ cartDrawer.style.display = 'none'; openCartBtn.setAttribute('aria-expanded','false'); updateCount(); }
    openCartBtn.addEventListener('click', openCart);
    closeCartBtn.addEventListener('click', closeCart);

    document.addEventListener('DOMContentLoaded', () => {
      saveCart(loadCart());               // Start-Bereinigung
      if(loadCart().length > 0){ openCart(); }
    });

    /* ----------------------- Angebot anfragen ----------------------- */
    askOfferBtn.addEventListener('click', ()=>{
      saveCart(loadCart());               // letzte Bereinigung
      const items = loadCart();
      if(items.length === 0){
        alert('Bitte zuerst Geräte auswählen.');
        return;
      }
      const counts = {};
      for (const id of items) counts[id] = (counts[id] || 0) + 1;

      const lines = Object.entries(counts).map(([cartId, qty])=>{
        const p = PRODUCTS.find(x=>x.cartId === cartId);
        const title = (p && (p.displayName || p.title)) || cartId;
        return `• ${title} × ${qty}`;
      });

      const msg = `Ausgewählte Produkte:\n${lines.join('\n')}`;
      sessionStorage.setItem('prefillOrder', msg);
      sessionStorage.setItem('contactPrefillText', msg);
      location.href = 'index.html#kontakt';
    });

    /* ----------------------- Filter + Grid Rendering ----------------------- */
    function chip(label, active){
      const b = document.createElement('button');
      b.type='button'; b.className='chip'+(active?' active':''); b.textContent=label;
      b.addEventListener('click', ()=>{
        document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
        b.addEventListener
        b.classList.add('active');
        render(label);
        window.scrollTo({top:document.getElementById('shop').offsetTop - 20, behavior:'smooth'});
      }, {once:false});
      return b;
    }
    CATS.forEach((c,i)=>filters.appendChild(chip(c, i===0)));

    function render(category){
      grid.innerHTML='';
      const cartItems = loadCart();
      const list = PRODUCTS.filter(p=>{
        if(category==='Alle') return true;
        if(category==='Kaffee Automat') return p.cat==='Kaffee Automat';
        if(category==='Snack & Food Automat') return p.cat==='Snack & Food Automat';
        if(category==='Theken Automat') return p.cat==='Theken Automat';
        return true;
      });

      list.forEach(p=>{
        const card = document.createElement('article');
        card.className='card';
        card.innerHTML = `
          <div class="thumb" data-detail="${p.id}"><img alt="${p.title}" src="${p.img}"></div>
          <div class="body">
            <h3 class="title" data-detail="${p.id}">${p.title}</h3>
            <p class="desc">${p.desc}</p>
            <button class="btn secondary select-btn" data-cart="${p.cartId}" aria-pressed="false">Auswählen</button>
          </div>
        `;
        // Bild & Titel -> Detailmodal (eindeutige id!)
        card.querySelectorAll('[data-detail]').forEach(el=>el.addEventListener('click', ()=> openProductModal(p.id)));
        // Button -> in den Warenkorb (cartId)
        card.querySelector('[data-cart]').addEventListener('click', ()=> { addToCart(p.cartId); openCart(); });
        grid.appendChild(card);
      });

      markButtons(cartItems);
      updateCount();
    }

    function markButtons(items){
      const map={}; for(const id of items){ map[id]=(map[id]||0)+1; }
      document.querySelectorAll('[data-cart]').forEach(btn=>{
        const cartId = btn.getAttribute('data-cart'); const qty = map[cartId] || 0;
        btn.setAttribute('aria-pressed', qty>0 ? 'true':'false');
        btn.textContent = qty>0 ? `Ausgewählt (${qty})` : 'Auswählen';
      });
    }

    /* ----------------------- Produkt-Detail-Modal ----------------------- */
    function openProductModal(id){
      const p = PRODUCTS.find(x=>x.id===id); // eindeutige id ⇒ korrektes Produkt
      if(!p) return;
      modalProductId = id;
      modalTitle.textContent = p.title;
      modalImg.src = p.img; modalImg.alt = p.title;
      modalDesc.textContent = p.details || p.desc || '';
      modalCat.textContent = p.cat ? `Kategorie: ${p.cat}` : '';
      modalFeatures.innerHTML = (p.features||[]).map(f=>`<li>${f}</li>`).join('');
      lastFocusedEl = document.activeElement;
      modal.classList.add('show'); document.body.classList.add('modal-open'); modal.setAttribute('aria-hidden','false');
      modalAddBtn.onclick = ()=>{ addToCart(p.cartId); openCart(); closeProductModal(); };
      modalAddBtn.focus();
      document.documentElement.classList.add("modal-open");
      document.body.classList.add("modal-open");
    }
    function closeProductModal(){
      modal.classList.remove('show');
      document.documentElement.classList.remove('modal-open');
      document.body.classList.remove('modal-open');
      modal.setAttribute('aria-hidden','true');
      if(lastFocusedEl) lastFocusedEl.focus();
    }
    document.getElementById('modalClose').addEventListener('click', closeProductModal);
    document.getElementById('modalClose2').addEventListener('click', closeProductModal);
    document.getElementById('modalBackdrop').addEventListener('click', closeProductModal);
    window.addEventListener('keydown', e=>{ if(e.key==='Escape' && modal.classList.contains('show')) closeProductModal(); });
    

    /* Start */
    render('Alle'); updateCount();
  </script>

  <script>
  // Fallback wenn sticky fehlt und kleiner Schatten beim Scrollen
  (function(){
    var header = document.querySelector('.site-header');
    if(!header) return;
    var stickyOk = CSS && (CSS.supports('position','sticky') || CSS.supports('position','-webkit-sticky'));
    if(!stickyOk && window.matchMedia('(max-width:768px)').matches){
      header.style.position = 'fixed';
      header.style.top = '0';
      header.style.left = '0';
      header.style.right = '0';
      document.body.style.paddingTop = getComputedStyle(header).getPropertyValue('min-height') || '72px';
    }
    var last = 0;
    window.addEventListener('scroll', function(){
      var y = window.pageYOffset || document.documentElement.scrollTop;
      if(y > 2 && !header.classList.contains('is-scrolled')) header.classList.add('is-scrolled');
      else if(y <= 2 && header.classList.contains('is-scrolled')) header.classList.remove('is-scrolled');
      last = y;
    }, {passive:true});
  })();
</script>

</body>
</html>
